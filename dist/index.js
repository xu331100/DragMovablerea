!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Drag=e()}(this,(function(){"use strict";!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&s.firstChild?s.insertBefore(o,s.firstChild):s.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}(".drag-container{\r\n    display: flex;\r\n    font-size: 14px;   \r\n}\r\n.left-menu{\r\n    width: 200px;\r\n}\r\n.right-con{\r\n    flex: 1;\r\n    border: solid 1px #dedede;\r\n    margin-left: 10px;\r\n    overflow-y: auto;\r\n    overflow-x: auto;\r\n}\r\n.move-div{\r\n    width: 100px;\r\n    height: 100px;\r\n    border: solid 1px #008000;\r\n    position: absolute;\r\n    cursor: move;\r\n}\r\n.zoom-wrapper{\r\n    position: relative;\r\n    overflow: hidden;\r\n    min-height: 100%;\r\n}\r\n.close-div{\r\n    width: 20px;\r\n    height: 20px;\r\n    position: absolute;\r\n    cursor: pointer;\r\n    top: -23px;\r\n    right: -23px;\r\n    background: #c00000;\r\n    border-radius: 50%;\r\n    text-align: center;\r\n    line-height: 20px;\r\n}\r\n.close-div:after{\r\n    content: '\\00D7';\r\n    font-size: 16px;\r\n    color: #fff;\r\n}");return class{constructor(t,e={}){if(!t)throw new Error("The provided selector is empty");this.pel=document.querySelector(t),this.el=this.pel.querySelector(t+"> div"),this.scale=void 0!==e.scale?e.scale:1,this.isClick=void 0===e.isClick||e.isClick,this.moveDivClass=e.moveDivClass||".move-div",this.delIconClass=e.delIconClass||".close-div",this.getMoveData=e.getMoveData,this.moveData=[],this.init(this.pel)}isMobile(){return null!=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}init(t){this.isMobile()?document.ontouchend=()=>{this.el.ontouchmove=null}:(document.addEventListener("dragover",(t=>{t.preventDefault()})),t.addEventListener("drop",(t=>{const e=t.dataTransfer.getData("Text");if(!t||!e)return;const i=-1!==e.indexOf("{")?JSON.parse(e):e;this.moveData.push({x:t.offsetX,y:t.offsetY,data:i}),this.getMoveData&&this.getMoveData(JSON.parse(JSON.stringify(this.moveData))),this.nextTick((()=>{this.updatePosLimit(this.moveData.length-1),this.bindMoveDivEvent(this.moveData.length-1)}))})),document.onmouseup=()=>{this.el.onmousemove=null}),this.setScale(this.scale),this.initMoveData()}initMoveData(){this.nextTick((()=>{const t=document.querySelectorAll(this.moveDivClass);Array.from(t).map(((t,e)=>{this.moveData.push({x:t.offsetLeft,y:t.offsetTop,data:t.getAttribute("data-o")}),this.moveDivEvent(t,e),this.bindDelEvent(t.querySelector(this.delIconClass),e)}))}))}setScale(t){if("number"!=typeof t)throw new Error("sacle非法");this.scale=t,this.el.style.transform=`scale(${t})`,this.el.style.transformOrigin="0 0"}makeDraggable(t,e){this.isMobile()||(t.style.cursor="move",t.setAttribute("draggable","true"),t.addEventListener("dragstart",(t=>{t.dataTransfer.setData("Text",e)}))),this.isClick&&t.addEventListener("click",(t=>{let i=Math.random()>.5?this.pel.offsetWidth/2+30*Math.random():this.pel.offsetWidth/2-30*Math.random(),s=Math.random()>.5?this.pel.scrollTop+this.pel.offsetHeight/2+30*Math.random():this.pel.scrollTop+this.pel.offsetHeight/2-30*Math.random();const o=e&&e.pos?e.pos.x:i,a=e&&e.pos?e.pos.y:s;this.moveData.push({x:o,y:a,data:e}),this.getMoveData&&this.getMoveData(JSON.parse(JSON.stringify(this.moveData))),this.nextTick((()=>{const t=document.querySelectorAll(this.moveDivClass).item(this.moveData.length-1),o=t.offsetWidth,a=t.offsetHeight;i=e&&e.pos?e.pos.x:i-o/2,s=e&&e.pos?e.pos.y:s-a/2,this.moveData[this.moveData.length-1].x=i,this.moveData[this.moveData.length-1].y=s,this.getMoveData&&this.getMoveData(JSON.parse(JSON.stringify(this.moveData))),this.nextTick((()=>{this.updatePosLimit(this.moveData.length-1),this.bindMoveDivEvent(this.moveData.length-1)}))}))}))}nextTick(t){new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)((function(e,i){t&&t(),i.disconnect()})).observe(this.pel,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0})}bindDelEvent(t,e){t&&t.addEventListener("click",(()=>{this.moveData.splice(e,1),this.getMoveData&&this.getMoveData(JSON.parse(JSON.stringify(this.moveData)))}))}bindMoveDivEvent(t){const e=document.querySelectorAll(this.moveDivClass);Array.from(e).map(((e,i)=>{t===i&&(this.moveDivEvent(e,t),this.bindDelEvent(e.querySelector(this.delIconClass),t))}))}moveDivEvent(t,e){this.isMobile()?(this.pel.addEventListener("touchmove",(()=>{}),{passive:!1}),t.ontouchstart=i=>{const s=i.targetTouches[0];let o=s.clientX/this.scale,a=s.clientY/this.scale;this.el.ontouchmove=i=>{i.preventDefault(),i.stopPropagation();const s=i.targetTouches[0],n=t.offsetLeft+s.clientX/this.scale-o,r=t.offsetTop+s.clientY/this.scale-a;o=s.clientX/this.scale,a=s.clientY/this.scale,this.limitDragPos(t,n,r,e)}}):t.onmousedown=i=>{this.pauseEvent(i);let s=i.clientX/this.scale,o=i.clientY/this.scale;this.el.onmousemove=i=>{const a=this.moveData[e].x+i.clientX/this.scale-s,n=this.moveData[e].y+i.clientY/this.scale-o;s=i.clientX/this.scale,o=i.clientY/this.scale,this.limitDragPos(t,a,n,e)}}}updatePosLimit(t){const e=document.querySelectorAll(this.moveDivClass);Array.from(e).map(((e,i)=>{t===i&&this.limitDragPos(e,e.offsetLeft,e.offsetTop,i)}))}limitDragPos(t,e,i,s){const o=this.el.offsetWidth-t.offsetWidth,a=this.el.offsetHeight-t.offsetHeight,n=Math.round(Math.max(0,Math.min(e,o))),r=Math.round(Math.max(0,Math.min(i,a)));this.moveData[s]=Object.assign(Object.assign({},this.moveData[s]),{x:n,y:r}),this.getMoveData&&this.getMoveData(JSON.parse(JSON.stringify(this.moveData)))}pauseEvent(t){return t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,!1}}}));
